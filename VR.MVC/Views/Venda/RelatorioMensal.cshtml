@model VR.MVC.ViewModels.RelatorioVendasMensalViewModel

@{
    ViewBag.Title = "RelatorioMensal";
    System.Threading.Thread.CurrentThread.CurrentCulture = new System.Globalization.CultureInfo("pt-BR");

    var meses = Enumerable.Range(1, 12).Select(i => new SelectListItem
    {
        Value = i.ToString(),
        Text = System.Globalization.CultureInfo.CurrentCulture.DateTimeFormat.GetMonthName(i),
        Selected = i == (int)ViewBag.Mes
    });

    int anoAtual = DateTime.Now.Year;
    var anos = Enumerable.Range(anoAtual - 5, 7).Select(i => new SelectListItem
    {
        Value = i.ToString(),
        Text = i.ToString(),
        Selected = i == (int)ViewBag.Ano
    }).OrderByDescending(a => a.Value);
}

<h2>Relatório de Vendas Mensais</h2>

@using (Html.BeginForm("RelatorioMensal", "Venda", FormMethod.Get, new { @class = "form-inline well well-sm" }))
{
    <div class="d-flex justify-content-between mt-5 mb-5 no-print">
        <div class="d-flex gap-3">
            <div class="form-group d-flex align-items-center mr-4 gap-2">
                <label for="mes" class="mr-2 mb-0">Mês:</label>
                @Html.DropDownList("mes", meses, new { @class = "form-control" })
            </div>

            <div class="form-group d-flex align-items-center mr-4 gap-2">
                <label for="ano" class="mr-2 mb-0">Ano:</label>
                @Html.DropDownList("ano", anos, new { @class = "form-control" })
            </div>
            <div>
                <button type="submit" class="btn btn-primary ml-3">
                    <i class="glyphicon glyphicon-search"></i> Gerar Relatório
                </button>
            </div>
        </div>
       

        <div>
 

            <a href="@Url.Action("Index")" class="btn btn-primary">
                <i class="glyphicon glyphicon-arrow-left"></i> Voltar para Vendas
            </a>
            <button type="button" class="btn btn-info ml-2" onclick="window.print()">
                <i class="glyphicon glyphicon-print"></i> Imprimir
            </button>

        </div>

    </div>
}

<div>
<div id="area-impressao" >


<div class="well well-lg mt-3">
    <p class="lead">
        Relatório de Vendas @System.Globalization.CultureInfo.CurrentCulture.DateTimeFormat.GetMonthName((int)ViewBag.Mes) De @ViewBag.Ano
    </p>

    <div class="d-flex justify-content-between align-items-center mb-4 border p-4 rounded-3">
        <p>
            Total Geral de Vendas: <span class="label label-primary">@Model.TotalVendas</span>
        </p>
        <p>
            Valor Total Vendido: <span class="label label-success">@Model.TotalVendido.ToString("C")</span>
        </p>
    </div>
 
</div>

<div class="row">
    <div class="col-md-6">
        <div class=" mb-5 text-center ">
            <h4>Vendas por Fabricante</h4>
        </div>

        @if (Model.PorFabricante.Any())
        {
            <table class="table table-striped table-hover">
                <thead class="bg-primary text-white">
                    <tr>
                        <th>Fabricante</th>
                        <th class="text-right">Quantidade</th>
                        <th class="text-right">Valor Vendido</th>
                        <th class="text-right">% do Total</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.PorFabricante)
                    {
                        <tr>
                            <td>@item.Fabricante</td>
                            <td class="text-right">@item.Quantidade</td>
                            <td class="text-right">@item.TotalVendido.ToString("C")</td>
                            <td class="text-right">@item.Percentual.ToString("N2")%</td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <p>Não houve vendas por fabricante no período selecionado.</p>
        }
    </div>

    <div class="col-md-6">
        <div class=" mb-5 text-center ">
            <h4>Vendas por Tipo de Veículo</h4>
        </div>

        @if (Model.PorTipoVeiculo.Any())
        {
            <table class="table table-striped table-hover">
                <thead class="bg-primary text-white">
                    <tr>
                        <th>Tipo</th>
                        <th class="text-right">Quantidade</th>
                        <th class="text-right">Valor Vendido</th>
                        <th class="text-right">% do Total</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.PorTipoVeiculo)
                    {
                        <tr>
                            <td>@item.Tipo</td>
                            <td class="text-right">@item.Quantidade</td>
                            <td class="text-right">@item.TotalVendido.ToString("C")</td>
                            <td class="text-right">@item.Percentual.ToString("N2")%</td>
                        </tr>
                    }
                </tbody>


            </table>
        }
        else
        {
            <p>Não houve vendas por tipo de veículo no período selecionado.</p>
        }
    </div>
</div>
</div>

</div>

<style>
    @@media print {
  
        .no-print {
            display: none !important;
        }
 
        header, nav, footer, .navbar, aside {
            display: none !important;
        }

        body * {
            visibility: hidden;
        }

        #area-impressao, #area-impressao * {
            visibility: visible !important;
        }

        #area-impressao {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
        }

        body {
            background: white !important;
            color: black !important;
            font-size: 12pt !important;
        }

        .table {
            border-collapse: collapse !important;
        }

            .table th, .table td {
                border: 1px solid black !important;
            }

        .badge {
            background-color: #f0f0f0 !important;
            color: black !important;
            border: 1px solid black !important;
        }
    }
</style>

